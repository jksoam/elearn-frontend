# Azure DevOps Pipeline for setting up Node.js v20, Java 11, Docker, and Maven

trigger:
- main

pool:
  vmImage: 'ubuntu-latest'

steps:
- task: Bash@3
  inputs:
    targetType: 'inline'
    script: |
      #!/bin/bash
      set -e  # Exit on error

      echo "ðŸ”„ Updating package index..."
      sudo apt update && sudo apt upgrade -y

      echo "ðŸ“¦ Installing prerequisites..."
      sudo apt install -y curl gnupg2 software-properties-common apt-transport-https ca-certificates lsb-release

      ###########################################
      # Node.js v20
      ###########################################
      echo "â¬‡ï¸ Installing Node.js v20..."
      curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
      sudo apt install -y nodejs

      echo "âœ… Node.js version: $(node -v)"
      echo "âœ… npm version: $(npm -v)"

      ###########################################
      # Java JDK 11
      ###########################################
      echo "â˜• Installing Java JDK 11..."
      sudo apt install -y openjdk-11-jdk
      echo "âœ… Java version:"
      java -version

      ###########################################
      # Docker (latest stable)
      ###########################################
      echo "ðŸ³ Installing Docker..."
      sudo apt remove -y docker docker-engine docker.io containerd runc || true

      sudo install -m 0755 -d /etc/apt/keyrings
      curl -fsSL https://download.docker.com/linux/ubuntu/gpg \
        | sudo gpg --dearmor -o /etc/apt/keyrings/docker.gpg

      echo \
        "deb [arch=$(dpkg --print-architecture) signed-by=/etc/apt/keyrings/docker.gpg] \
        https://download.docker.com/linux/ubuntu \
        $(lsb_release -cs) stable" | \
        sudo tee /etc/apt/sources.list.d/docker.list > /dev/null

      sudo apt update
      sudo apt install -y docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin

      sudo usermod -aG docker $USER
      echo "âœ… Docker version: $(docker --version)"

      ###########################################
      # Maven
      ###########################################
      echo "ðŸ”§ Installing Maven..."
      sudo apt install -y maven
      echo "âœ… Maven version: $(mvn -v)"

      echo "ðŸŽ‰ All tools installed successfully!"
      echo "ðŸ“Œ Please logout and login again to apply docker group permission."
